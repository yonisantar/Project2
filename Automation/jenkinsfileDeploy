pipeline{
    agent any
    environment {
        TERRAFORM_FOLDER_NAME= 'Terraform'
        APP_REPO = 'https://github.com/devopsPRO27/devops-personal-project.git'
        FOLDER_NAME= 'api'
        CONTAINER_NAME = 'api-app'
        EXTERNAL_APP_PORT = '5000'
        INTERNAL_APP_PORT = '5000'
        TAG = 'v1.${BUILD_NUMBER}'
        ACCOUNT_NAME= 'yit1977ltld/apiproject'
        IMAGE_NAME = "${ACCOUNT_NAME}:latest"
        REGISTRY= 'hub.docker.com'
        DOCKERHUB_CREDENIALS = credentials('DockerCred')
        SHARED_WORKSPACE = '/var/jenkins_home/workspace/Deploy Enviroment'
        CREDENTIALS_ID = 'devopsSSH'
        USER_NAME = 'ubuntu'
        JSON_TEST_REQUEST = '{\"ip\": \"8.8.8.8\"}'
        OK_STATUS_CODE = '200'
        URL_TRACERT = 'traceroute'
        URL_VALIDATE_IP = 'validate_ip'
    }    
     stages {
       stage("Clone App source code"){
            steps{
                sh 'pwd'
                sh 'ls -la'
                sh "clone ${APP_REPO}"
                }
            }
            post{
                success{
                    echo "App Clone Success"
                }
                failure{
                    echo "App Clone Failure"
                }
            }
    }
    post{
         always {
            script {
                if (env.PUBLIC_IP) {
                    echo "Server PUBLIC_IP is : ${PUBLIC_IP}"
                } else {
                    echo "PUBLIC_IP is empty"
                }
            }
        }
        success{
            echo "========pipeline executed successfully ========"
        }
        failure{
            echo "========pipeline execution failed========"
        }
    }
}